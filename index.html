<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é…’ç²¾å–®ä½æ›ç®—å™¨</title>
  <style>
    body { font-family: sans-serif; }
    .hidden { display: none; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px 10px; }
  </style>
</head>
<body>
  <h2>é…’ç²¾å–®ä½æ›ç®—å™¨</h2>
  <button id="switchMode">åˆ‡æ›åˆ°ç™»å…¥æ¨¡å¼</button>

  <!-- è¨ªå®¢æ¨¡å¼ -->
  <div id="guestMode">
    <h3>ğŸ§¾ è¨ªå®¢æ¨¡å¼ï¼ˆä¸éœ€ç™»å…¥ï¼‰</h3>
    <label>è«‹é¸æ“‡é…’é¡ï¼š</label>
    <select id="drinkGuest">
      <option value="1.2">ç½è£å•¤é…’ï¼ˆ350ccï¼‰</option>
      <option value="6.3">è‘¡è„é…’ / ç´…é…’ï¼ˆ600ccï¼‰</option>
      <option value="13.2">ç±³é…’ï¼ˆ600ccï¼‰</option>
      <option value="22.8">38åº¦é«˜ç²±é…’ï¼ˆ600ccï¼‰</option>
      <option value="24">58åº¦é«˜ç²±é…’ï¼ˆ600ccï¼‰</option>
      <option value="28">å¨å£«å¿Œï¼ˆ700ccï¼‰</option>
    </select>
    <br><br>
    <label>é£²ç”¨é‡ï¼ˆmlï¼‰ï¼š</label>
    <input id="mlGuest" type="number" placeholder="è«‹è¼¸å…¥ml">
    <button onclick="calcGuest()">æ›ç®—</button>
    <div id="resultGuest"></div>
    <p style="font-size: 0.9em; color: gray;">â€» å»ºè­°æ¯æ—¥é…’ç²¾æ”å–é‡ï¼šç”·æ€§ä¸è¶…é 2 å–®ä½ï¼Œå¥³æ€§ä¸è¶…é 1 å–®ä½</p>
  </div>

  <!-- ç™»å…¥æ¨¡å¼ -->
  <div id="loginMode" class="hidden">
    <h3>ç™»å…¥æ¨¡å¼ï¼ˆå¯å„²å­˜è¨˜éŒ„ï¼‰</h3>
    <div id="history"></div>
    <button onclick="clearHistory()">æ¸…é™¤ç´€éŒ„</button>
  </div>

<script>
function calcGuest() {
  const unitPerDrink = parseFloat(document.getElementById('drinkGuest').value);
  const ml = parseFloat(document.getElementById('mlGuest').value);
  if (isNaN(unitPerDrink) || isNaN(ml)) {
    document.getElementById('resultGuest').innerText = 'è«‹è¼¸å…¥æœ‰æ•ˆè³‡æ–™';
    return;
  }

  // æ ¹æ“šä¸åŒé…’é¡å®¹é‡å‹•æ…‹è¨­å®š fullVolume
  const selectedText = document.getElementById('drinkGuest').options[document.getElementById('drinkGuest').selectedIndex].text;
  const volumeMatch = selectedText.match(/(\d+)cc/);
  const fullVolume = volumeMatch ? parseInt(volumeMatch[1]) : 350;
  const ratio = ml / fullVolume;
  const units = unitPerDrink * ratio;
  const result = `æ›ç®—çµæœï¼šç´„ ${units.toFixed(1)} å–®ä½`;
  document.getElementById('resultGuest').innerText = result;

  const record = {
    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
    drink: selectedText,
    ml: ml,
    unit: units.toFixed(1),
    date: new Date().toLocaleDateString()
  };
  let history = JSON.parse(localStorage.getItem('alcoholHistory') || '[]');
  history.push(record);
  localStorage.setItem('alcoholHistory', JSON.stringify(history));
}

function displayHistory() {
  let history = JSON.parse(localStorage.getItem('alcoholHistory') || '[]');
  if (history.length === 0) {
    document.getElementById('history').innerText = 'ç›®å‰æ²’æœ‰ç´€éŒ„';
    return;
  }
  let html = '<table><tr><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>é…’é¡</th><th>é£²ç”¨é‡ml</th><th>å–®ä½</th></tr>';
  for (const r of history.reverse()) {
    html += `<tr><td>${r.date}</td><td>${r.time}</td><td>${r.drink}</td><td>${r.ml}</td><td>${r.unit}</td></tr>`;
  }
  html += '</table>';
  document.getElementById('history').innerHTML = html;
}

function clearHistory() {
  localStorage.removeItem('alcoholHistory');
  displayHistory();
}

document.getElementById('switchMode').onclick = function () {
  const guest = document.getElementById('guestMode');
  const login = document.getElementById('loginMode');
  if (guest.classList.contains('hidden')) {
    guest.classList.remove('hidden');
    login.classList.add('hidden');
    this.innerText = 'åˆ‡æ›åˆ°ç™»å…¥æ¨¡å¼';
  } else {
    guest.classList.add('hidden');
    login.classList.remove('hidden');
    this.innerText = 'åˆ‡æ›åˆ°è¨ªå®¢æ¨¡å¼';
    displayHistory();
  }
};
</script>
</body>
</html>
